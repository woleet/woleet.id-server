openapi: 3.0.0
info:
  description: This is Woleet.ID Server API documentation.
  version: 1.2.8
  title: Woleet.ID Server
  contact:
    email: contact@woleet.com
  license:
    name: CC BY-NC-SA 4.0
security:
  - CookieAuth: []
  - APITokenAuth: []
paths:
  /login:
    get:
      tags:
        - Authentication
      summary: Log into the system.
      description: Both email or username can be used to authenticate.
      operationId: login
      security:
        - BasicAuth: []
      responses:
        '200':
          description: User successfully logged in. A session cookie is returned.
          content:
            application/json:
              schema:
                $ref: '#/components/responses/UserInfo'
        '400':
          description: Missing email/username or password.
          content:
            application/json:
              schema:
                $ref: '#/components/responses/APIError'
        '401':
          description: Invalid email/username or password.
          content:
            application/json:
              schema:
                $ref: '#/components/responses/APIError'
  /logout:
    get:
      tags:
        - Authentication
      summary: Log out from the system.
      operationId: logout
      security:
        - CookieAuth: []
      responses:
        '204':
          description: User successfully logged out.
  /info:
    get:
      tags:
        - Authentication
      summary: Get information about the current logged user.
      operationId: getUserInfo
      responses:
        '200':
          description: Successful operation.
          content:
            application/json:
              schema:
                $ref: '#/components/responses/UserInfo'
        '401':
          description: Missing or invalid session cookie.
          content:
            application/json:
              schema:
                $ref: '#/components/responses/APIError'
  /sign:
    get:
      operationId: getSignature
      summary: Sign a message or a SHA256 hash using a key.
      tags:
        - Signature
      description: >
        Use this endpoint to sign a message or a SHA256 hash using one of the keys managed by the server.<br>
        **NOTE: this endpoint is by default exposed on the port 3002, and not on port 3000 like for other API endpoints.
        It is not recommended to expose this endpoint publicly on the internet.**<br>
        Provide the message to sign in the `messageToSign` parameter, or the SHA256 hash to sign in the `hashToSign` parameter.<br>
        When authenticated as an admin, the key to use can be specified using the `pubKey`, `userId` and/or `customUserId` parameters:<br>
        - set the `pubKey` parameter only: the referred key is used<br>
        - set the `userId` (or the `customUserId`) parameter only: the default key of the referred user is used (if any).<br>
        - set none of the 3 parameters: the default key of the server is used (if any).<br>
        When authenticated as a user, the key to use must be one of the authenticated user's keys and can be specified using the `pubKey` parameter.<br>
        If not specified, the authenticated user's default key is used (if any).<br>
        If the server is configured to prevent identity exposure, the caller must always provide the `identityToSign` parameter.
      parameters:
        - $ref: '#/components/parameters/HashToSignQueryParameter'
        - $ref: '#/components/parameters/MessageToSignQueryParameter'
        - $ref: '#/components/parameters/UserIdQueryParameter'
        - $ref: '#/components/parameters/CustomUserIdQueryParameter'
        - $ref: '#/components/parameters/PubKeyQueryParameter'
        - $ref: '#/components/parameters/PathQueryParameter'
        - $ref: '#/components/parameters/IdentityToSignQueryParameter'
      security:
        - APITokenAuth: []
        - OAuthTokenAuth: []
      responses:
        '200':
          description: >
            Successful operation. The produced signature and its associated parameters are returned as a JSON object<br>
            Note that if your are using the Woleet API and you want to anchor this signature,
            you can simply add a `name` field to the returned JSON object, and provide it as is to the `POST /anchor` endpoint.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SignatureResult'
        '400':
          description: Missing or invalid query parameter. More details are returned in the response body.
          content:
            application/json:
              schema:
                $ref: '#/components/responses/APIError'
        '401':
          description: Missing or invalid token. More details are returned in the response body.
          content:
            application/json:
              schema:
                $ref: '#/components/responses/APIError'
        '404':
          description: Key or User not found.
          content:
            application/json:
              schema:
                $ref: '#/components/responses/APIError'
        '403':
          description: No `pubKey` parameter is provided and the server or the user has no default key to fallback on.
          content:
            application/json:
              schema:
                $ref: '#/components/responses/APIError'
  /identity:
    get:
      operationId: getIdentity
      summary: Verify the identity of a user.
      security: []
      tags:
        - Identity
      description: >
        Use this endpoint to verify that the server knows a given public key and to get or check the identity of the user owning that key.<br>
        **NOTE: this endpoint is not protected and by default exposed on the port 3001, and not on port 3000 like for other API endpoints.<br>
        It is recommended to expose this endpoint publicly on the internet on HTTPS default port 443 and to configure the server's identity URL so that it resolves on this endpoint.**<br>
        If the server controls the private key associated to the public key, it can also sign some random data and return the produced signature to prove it owns the key.<br>
        The random data is built by concatenating the `leftData` parameter (provided by the client) and some random data generated by the server (returned in the `rightData` field).<br>
        The caller can then verify that the returned signature is valid for the public key (which proves the ownership of the private key by the server).<br>
        The caller can optionally read the TLS certificate securing this endpoint to get the certified identity of the owner of the domain of this identity endpoint.<br>
        If the server is configured to prevent identity exposure, the caller must always provide the `signedIdentity` parameter.
      parameters:
        - $ref: '#/components/parameters/PubKeyToVerifyQueryParameter'
        - $ref: '#/components/parameters/SignedIdentityToVerifyQueryParameter'
        - $ref: '#/components/parameters/LeftDataQueryParameter'
      responses:
        '200':
          description: Successful operation.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/IdentityResult'
        '400':
          description: Missing or invalid query parameter.
          content:
            application/json:
              schema:
                $ref: '#/components/responses/APIError'
        '404':
          description: Public key not found.
          content:
            application/json:
              schema:
                $ref: '#/components/responses/APIError'
  /discover/users:
    get:
      operationId: discoverUsers
      summary: Get all the users matching a set of filters.
      description: >
        Use this operation to get all the users, or a subset of the users matching specified filters.<br>
        Results can be paged.
      security:
        - APITokenAuth: []
        - OAuthTokenAuth: []
      tags:
        - Discovery
      parameters:
        - $ref: '#/components/parameters/PagingOffsetQueryParameter'
        - $ref: '#/components/parameters/PagingLimitQueryParameter'
        - $ref: '#/components/parameters/FilterUserSearchQueryParameter'
      responses:
        '200':
          description: Successful operation.
          content:
            application/json:
              schema:
                $ref: '#/components/responses/UserDiscoArray'
        '401':
          description: Missing or invalid session cookie.
          content:
            application/json:
              schema:
                $ref: '#/components/responses/APIError'
  /discover/user/{pubKey}:
    get:
      operationId: discoverUserByPubKey
      summary: Get the user associated to a public key.
      security:
        - APITokenAuth: []
        - OAuthTokenAuth: []
      tags:
        - Discovery
      parameters:
        - $ref: '#/components/parameters/PubKeyParameter'
      responses:
        '200':
          description: Successful operation.
          content:
            application/json:
              schema:
                $ref: '#/components/responses/UserDisco'
        '401':
          description: Missing or invalid session cookie.
          content:
            application/json:
              schema:
                $ref: '#/components/responses/APIError'
        '404':
          description: User not found.
          content:
            application/json:
              schema:
                $ref: '#/components/responses/APIError'
  /discover/user:
    get:
      operationId: discoverUser
      summary: Get the current authenticated user.
      security:
        - APITokenAuth: []
        - OAuthTokenAuth: []
      tags:
        - Discovery
      responses:
        '200':
          description: Successful operation.
          content:
            application/json:
              schema:
                $ref: '#/components/responses/UserDisco'
        '204':
          description: Successful operation. The current authenticated user is a server admin.
        '401':
          description: Missing or invalid session cookie.
          content:
            application/json:
              schema:
                $ref: '#/components/responses/APIError'
        '404':
          description: User not found.
          content:
            application/json:
              schema:
                $ref: '#/components/responses/APIError'
  /discover/keys/{userId}:
    get:
      operationId: discoverUserKeys
      summary: Get all the public keys of a user.
      security:
        - APITokenAuth: []
        - OAuthTokenAuth: []
      tags:
        - Discovery
      parameters:
        - $ref: '#/components/parameters/UserIdParameter'
      responses:
        '200':
          description: Successful operation.
          content:
            application/json:
              schema:
                $ref: '#/components/responses/KeyDiscoArray'
        '400':
          description: Invalid user identifier.
          content:
            application/json:
              schema:
                $ref: '#/components/responses/APIError'
        '401':
          description: Missing or invalid session cookie.
          content:
            application/json:
              schema:
                $ref: '#/components/responses/APIError'
        '404':
          description: User not found.
          content:
            application/json:
              schema:
                $ref: '#/components/responses/APIError'
  /discover/config:
    get:
      operationId: discoverConfig
      summary: Get the server configuration.
      security:
        - APITokenAuth: []
        - OAuthTokenAuth: []
      tags:
        - Discovery
      responses:
        '200':
          description: Successful operation.
          content:
            application/json:
              schema:
                $ref: '#/components/responses/ConfigDisco'
        '401':
          description: Missing or invalid session cookie.
          content:
            application/json:
              schema:
                $ref: '#/components/responses/APIError'
  /key/{keyId}:
    get:
      tags:
        - Key
      summary: Get a key by its identifier.
      operationId: getKeyById
      parameters:
        - $ref: '#/components/parameters/KeyIdParameter'
      responses:
        '200':
          description: Successful operation.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/KeyGet'
        '400':
          description: Invalid key identifier.
          content:
            application/json:
              schema:
                $ref: '#/components/responses/APIError'
        '401':
          description: Missing or invalid session cookie.
          content:
            application/json:
              schema:
                $ref: '#/components/responses/APIError'
        '404':
          description: Key not found.
          content:
            application/json:
              schema:
                $ref: '#/components/responses/APIError'
    put:
      tags:
        - Key
      summary: Update a key.
      operationId: updateKey
      parameters:
        - $ref: '#/components/parameters/KeyIdParameter'
      requestBody:
        $ref: '#/components/requestBodies/KeyPut'
      responses:
        '200':
          description: Successful operation.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/KeyGet'
        '400':
          description: Invalid key identifier.
          content:
            application/json:
              schema:
                $ref: '#/components/responses/APIError'
        '401':
          description: Missing or invalid session cookie.
          content:
            application/json:
              schema:
                $ref: '#/components/responses/APIError'
        '404':
          description: Key not found.
          content:
            application/json:
              schema:
                $ref: '#/components/responses/APIError'
    delete:
      tags:
        - Key
      summary: Delete a key.
      operationId: deleteKey
      parameters:
        - $ref: '#/components/parameters/KeyIdParameter'
      responses:
        '200':
          description: Successful operation.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/KeyGet'
        '400':
          description: Invalid key identifier.
          content:
            application/json:
              schema:
                $ref: '#/components/responses/APIError'
        '401':
          description: Missing or invalid session cookie.
          content:
            application/json:
              schema:
                $ref: '#/components/responses/APIError'
        '404':
          description: Key not found.
          content:
            application/json:
              schema:
                $ref: '#/components/responses/APIError'
  /user/{userId}/extern-key:
    post:
      tags:
        - Key
      summary: Create a new external key for a user.
      description: >
        Use this endpoint to register a public key that is controlled by a user on an external device.
      operationId: createExternalKey
      parameters:
        - $ref: '#/components/parameters/UserIdParameter'
      requestBody:
        $ref: '#/components/requestBodies/ExternalKeyPost'
      responses:
        '200':
          description: Successful operation.
          content:
            application/json:
              schema:
                $ref: '#/components/responses/KeyGet'
        '400':
          description: Invalid input.
          content:
            application/json:
              schema:
                $ref: '#/components/responses/APIError'
        '401':
          description: Missing or invalid session cookie.
          content:
            application/json:
              schema:
                $ref: '#/components/responses/APIError'
        '404':
          description: User not found.
          content:
            application/json:
              schema:
                $ref: '#/components/responses/APIError'
  /user/{userId}/key:
    post:
      tags:
        - Key
      summary: Create a new key for a user.
      operationId: createKey
      parameters:
        - $ref: '#/components/parameters/UserIdParameter'
      requestBody:
        $ref: '#/components/requestBodies/KeyPost'
      responses:
        '200':
          description: Successful operation.
          content:
            application/json:
              schema:
                $ref: '#/components/responses/KeyGet'
        '400':
          description: Invalid input.
          content:
            application/json:
              schema:
                $ref: '#/components/responses/APIError'
        '401':
          description: Missing or invalid session cookie.
          content:
            application/json:
              schema:
                $ref: '#/components/responses/APIError'
        '404':
          description: User not found.
          content:
            application/json:
              schema:
                $ref: '#/components/responses/APIError'
  /user/{userId}/key/list:
    get:
      tags:
        - Key
      summary: Get all the keys of a user.
      operationId: getUserKeys
      parameters:
        - $ref: '#/components/parameters/UserIdParameter'
      responses:
        '200':
          description: Successful operation.
          content:
            application/json:
              schema:
                $ref: '#/components/responses/KeyArray'
        '400':
          description: Invalid user identifier.
          content:
            application/json:
              schema:
                $ref: '#/components/responses/APIError'
        '401':
          description: Missing or invalid session cookie.
          content:
            application/json:
              schema:
                $ref: '#/components/responses/APIError'
        '404':
          description: User not found.
          content:
            application/json:
              schema:
                $ref: '#/components/responses/APIError'
  /user:
    post:
      tags:
        - User
      summary: Create a new user.
      operationId: createUser
      requestBody:
        description: User object to create.
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserPost'
      responses:
        '200':
          description: Successful operation.
          content:
            application/json:
              schema:
                $ref: '#/components/responses/UserGet'
        '401':
          description: Missing or invalid session cookie.
          content:
            application/json:
              schema:
                $ref: '#/components/responses/APIError'
        '400':
          description: Invalid object supplied.
          content:
            application/json:
              schema:
                $ref: '#/components/responses/APIError'
  /user/{userId}:
    get:
      tags:
        - User
      summary: Get a user by his identifier.
      operationId: getUserById
      parameters:
        - $ref: '#/components/parameters/UserIdParameter'
      responses:
        '200':
          description: Successful operation.
          content:
            application/json:
              schema:
                $ref: '#/components/responses/UserGet'
        '400':
          description: Invalid user identifier.
          content:
            application/json:
              schema:
                $ref: '#/components/responses/APIError'
        '401':
          description: Missing or invalid session cookie.
          content:
            application/json:
              schema:
                $ref: '#/components/responses/APIError'
        '404':
          description: User not found.
          content:
            application/json:
              schema:
                $ref: '#/components/responses/APIError'
    put:
      tags:
        - User
      summary: Update a user.
      operationId: updateUser
      parameters:
        - $ref: '#/components/parameters/UserIdParameter'
      requestBody:
        description: User object to update.
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserPut'
        required: true
      responses:
        '200':
          description: Successful operation.
          content:
            application/json:
              schema:
                $ref: '#/components/responses/UserGet'
        '400':
          description: Invalid object supplied / Invalid user identifier.
          content:
            application/json:
              schema:
                $ref: '#/components/responses/APIError'
        '401':
          description: Missing or invalid session cookie.
          content:
            application/json:
              schema:
                $ref: '#/components/responses/APIError'
        '404':
          description: User not found.
          content:
            application/json:
              schema:
                $ref: '#/components/responses/APIError'
    delete:
      tags:
        - User
      summary: Delete a user.
      operationId: deleteUser
      parameters:
        - $ref: '#/components/parameters/UserIdParameter'
      responses:
        '200':
          description: Successful operation.
          content:
            application/json:
              schema:
                $ref: '#/components/responses/UserGet'
        '400':
          description: Invalid user identifier.
          content:
            application/json:
              schema:
                $ref: '#/components/responses/APIError'
        '401':
          description: Missing or invalid session cookie.
          content:
            application/json:
              schema:
                $ref: '#/components/responses/APIError'
        '404':
          description: User not found.
          content:
            application/json:
              schema:
                $ref: '#/components/responses/APIError'
  /user/list:
    get:
      operationId: getUsers
      summary: Get all the users matching a set of filters.
      description: >
        Use this operation to get all the users, or a subset of the users matching specified filters.<br>
        Results can be paged.
      tags:
        - User
      parameters:
        - $ref: '#/components/parameters/PagingOffsetQueryParameter'
        - $ref: '#/components/parameters/PagingLimitQueryParameter'
        - $ref: '#/components/parameters/FilterUserSearchQueryParameter'
        - $ref: '#/components/parameters/FilterUserModeQueryParameter'
        - $ref: '#/components/parameters/FilterUserRoleQueryParameter'
        - $ref: '#/components/parameters/FilterUserEmailQueryParameter'
        - $ref: '#/components/parameters/FilterUserUsernameQueryParameter'
        - $ref: '#/components/parameters/FilterUserCommonNameQueryParameter'
        - $ref: '#/components/parameters/FilterUserOrganizationQueryParameter'
        - $ref: '#/components/parameters/FilterUserOrganizationalUnitQueryParameter'
        - $ref: '#/components/parameters/FilterUserLocalityQueryParameter'
        - $ref: '#/components/parameters/FilterUserCountryQueryParameter'
        - $ref: '#/components/parameters/FilterUserUserIdQueryParameter'
        - $ref: '#/components/parameters/FilterUserCountryCallingCodeQueryParameter'
        - $ref: '#/components/parameters/FilterUserPhoneQueryParameter'
        - $ref: '#/components/parameters/FilterUserStatusQueryParameter'
      responses:
        '200':
          description: Array of users.
          content:
            application/json:
              schema:
                $ref: '#/components/responses/UserArray'
  /api-token:
    post:
      tags:
        - API Token
      summary: Create an API token.
      operationId: createAPIToken
      requestBody:
        description: API token object to create.
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/APITokenPost'
      responses:
        '200':
          description: Successful operation.
          content:
            application/json:
              schema:
                $ref: '#/components/responses/APITokenGet'
        '400':
          description: Invalid object supplied.
          content:
            application/json:
              schema:
                $ref: '#/components/responses/APIError'
        '401':
          description: Missing or invalid session cookie.
          content:
            application/json:
              schema:
                $ref: '#/components/responses/APIError'
        '403':
          description: Users cannot manage other users' API tokens.
          content:
            application/json:
              schema:
                $ref: '#/components/responses/APIError'
  /api-token/{APITokenId}:
    get:
      tags:
        - API Token
      summary: Get an API token by its identifier.
      operationId: getAPITokenById
      parameters:
        - $ref: '#/components/parameters/APITokenIdParameter'
      responses:
        '200':
          description: Successful operation.
          content:
            application/json:
              schema:
                $ref: '#/components/responses/APITokenGet'
        '400':
          description: Invalid API token identifier.
          content:
            application/json:
              schema:
                $ref: '#/components/responses/APIError'
        '401':
          description: Missing or invalid session cookie.
          content:
            application/json:
              schema:
                $ref: '#/components/responses/APIError'
        '403':
          description: Users cannot manage other users' API tokens.
          content:
            application/json:
              schema:
                $ref: '#/components/responses/APIError'
        '404':
          description: API token not found.
          content:
            application/json:
              schema:
                $ref: '#/components/responses/APIError'
    put:
      tags:
        - API Token
      summary: Update an API token.
      operationId: updateAPIToken
      parameters:
        - $ref: '#/components/parameters/APITokenIdParameter'
      requestBody:
        description: API token object to update.
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/APITokenPut'
        required: true
      responses:
        '200':
          description: Successful operation.
          content:
            application/json:
              schema:
                $ref: '#/components/responses/APITokenGet'
        '400':
          description: Invalid object supplied.
          content:
            application/json:
              schema:
                $ref: '#/components/responses/APIError'
        '401':
          description: Missing or invalid session cookie.
          content:
            application/json:
              schema:
                $ref: '#/components/responses/APIError'
        '403':
          description: Users cannot manage other users' API tokens.
          content:
            application/json:
              schema:
                $ref: '#/components/responses/APIError'
        '404':
          description: API token not found.
          content:
            application/json:
              schema:
                $ref: '#/components/responses/APIError'
    delete:
      tags:
        - API Token
      summary: Delete an API token.
      operationId: deleteAPIToken
      parameters:
        - $ref: '#/components/parameters/APITokenIdParameter'
      responses:
        '200':
          description: Successful operation.
          content:
            application/json:
              schema:
                $ref: '#/components/responses/APITokenGet'
        '400':
          description: Invalid API token identifier.
          content:
            application/json:
              schema:
                $ref: '#/components/responses/APIError'
        '401':
          description: Missing or invalid session cookie.
          content:
            application/json:
              schema:
                $ref: '#/components/responses/APIError'
        '403':
          description: Users cannot manage other users' API tokens.
          content:
            application/json:
              schema:
                $ref: '#/components/responses/APIError'
        '404':
          description: API token not found.
          content:
            application/json:
              schema:
                $ref: '#/components/responses/APIError'
  /api-token/list:
    get:
      tags:
        - API Token
      summary: Get all API tokens.
      description:  When logged as a user, only the tokens belonging to the user are returned.
      operationId: getAPITokens
      responses:
        '200':
          description: Succesful operation.
          content:
            application/json:
              schema:
                $ref: '#/components/responses/APITokenArray'
        '401':
          description: Missing or invalid session cookie.
          content:
            application/json:
              schema:
                $ref: '#/components/responses/APIError'
  /server-config:
    get:
      tags:
        - Server Config
      summary: Get the server configuration.
      operationId: getServerConfig
      responses:
        '200':
          description: Successful operation.
          content:
            application/json:
              schema:
                $ref: '#/components/responses/ServerConfig'
        '400':
          description: Invalid API token identifier.
          content:
            application/json:
              schema:
                $ref: '#/components/responses/APIError'
        '401':
          description: Missing or invalid session cookie.
          content:
            application/json:
              schema:
                $ref: '#/components/responses/APIError'
        '404':
          description: API token not found.
          content:
            application/json:
              schema:
                $ref: '#/components/responses/APIError'
    put:
      tags:
        - Server Config
      summary: Update the server configuration.
      operationId: updateServerConfig
      requestBody:
        $ref: '#/components/requestBodies/ServerConfig'
      responses:
        '200':
          description: Successful operation.
          content:
            application/json:
              schema:
                $ref: '#/components/responses/ServerConfig'
        '400':
          description: Invalid object supplied.
          content:
            application/json:
              schema:
                $ref: '#/components/responses/APIError'
        '401':
          description: Missing or invalid session cookie.
          content:
            application/json:
              schema:
                $ref: '#/components/responses/APIError'
        '404':
          description: API token not found.
          content:
            application/json:
              schema:
                $ref: '#/components/responses/APIError'
  /enrollment:
    post:
      tags:
        - Enrollment
      summary: Create a key enrollment request.
      operationId: createEnrollment
      requestBody:
        $ref: '#/components/requestBodies/EnrollmentPost'
      responses:
        '200':
          description: Successful operation.
          content:
            application/json:
              schema:
                $ref: '#/components/responses/EnrollmentGet'
        '400':
          description: Invalid object supplied.
          content:
            application/json:
              schema:
                $ref: '#/components/responses/APIError'
        '401':
          description: Missing or invalid session cookie.
          content:
            application/json:
              schema:
                $ref: '#/components/responses/APIError'
  /enrollment/list:
    get:
      tags:
        - Enrollment
      summary: Get all key enrollment requests.
      operationId: getEnrollments
      responses:
        '200':
          description: Successful operation.
          content:
            application/json:
              schema:
                $ref: '#/components/responses/EnrollmentArray'
  /enrollment/{EnrollmentId}:
    get:
      tags:
        - Enrollment
      summary: Get a key enrollment request.
      operationId: getEnrollment
      parameters:
        - $ref: '#/components/parameters/EnrollmentIdParameter'
      responses:
        '200':
          description: Successful operation.
          content:
            application/json:
              schema:
                $ref: '#/components/responses/EnrollmentGet'
    put:
      tags:
        - Enrollment
      summary: Update a key enrollment request.
      operationId: updateEnrollment
      parameters:
        - $ref: '#/components/parameters/EnrollmentIdParameter'
      requestBody:
        $ref: '#/components/requestBodies/EnrollmentPut'
      responses:
        '200':
          description: Successful operation.
          content:
            application/json:
              schema:
                $ref: '#/components/responses/EnrollmentGet'
        '400':
          description: Invalid object supplied.
          content:
            application/json:
              schema:
                $ref: '#/components/responses/APIError'
        '401':
          description: Missing or invalid session cookie.
          content:
            application/json:
              schema:
                $ref: '#/components/responses/APIError'
    delete:
      tags:
        - Enrollment
      summary: Delete a key enrollment request.
      operationId: deleteEnrollment
      parameters:
        - $ref: '#/components/parameters/EnrollmentIdParameter'
      responses:
        '200':
          description: Successful operation.
          content:
            application/json:
              schema:
                $ref: '#/components/responses/EnrollmentGet'
        '400':
          description: Invalid object supplied.
          content:
            application/json:
              schema:
                $ref: '#/components/responses/APIError'
        '401':
          description: Missing or invalid session cookie.
          content:
            application/json:
              schema:
                $ref: '#/components/responses/APIError'
  /enrollment/{EnrollmentId}/create-signature-request:
    post:
      tags:
        - Enrollment
      summary: Create and send the signature request of the TCU to the owner of the enrolled key.
      security: []
      operationId: createSignatureRequest
      parameters:
        - $ref: '#/components/parameters/EnrollmentIdParameter'
      responses:
        '200':
          description: Successful operation.
        '400':
          description: Invalid object supplied / The signature request creation is not possible.
          content:
            application/json:
              schema:
                $ref: '#/components/responses/APIError'
  /enrollment/{EnrollmentId}/user:
    get:
      tags:
        - Enrollment
      summary: Get the user of a key enrollment request.
      security: []
      operationId: getEnrollmentUser
      parameters:
        - $ref: '#/components/parameters/EnrollmentIdParameter'
      responses:
        '200':
          description: Successful operation.
          content:
            application/json:
              schema:
                $ref: '#/components/responses/UserGet'
  /check:
    get:
      operationId: check
      tags:
        - Healthcheck
      summary: Check the database availability.
      security: []
      responses:
        '200':
          description: Successful operation.
        '503':
          description: the database is unavailable.
components:
  schemas:
    Identity:
      type: object
      description: User identity provided as a set of X500 Distinguished Name attributes (see https://www.ietf.org/rfc/rfc4519.txt).
      properties:
        commonName:
          type: string
          description: Common name (CN) (2.5.4.3)
          example: "John Doe"
        organization:
          type: string
          description: Organization name (O) (2.5.4.10)
          example: "Acme corp"
        organizationalUnit:
          type: string
          description: Organizational unit name (OU) (2.5.4.11)
          example: "Sales dept"
        locality:
          type: string
          description: Locality name (L) (2.5.4.7)
          example: "Rennes"
        country:
          type: string
          description: Country code (C) (2.5.4.6)
          example: "FR"
        emailAddress:
          type: string
          format: email
          description: Email address.
          example: "john.doe@acme.com"
      required:
        - commonName
    Key:
      type: object
      description: Key information.
      properties:
        name:
          type: string
          description: Key name.
          example: "Jim Smith's key"
        pubKey:
          type: string
          description: Public key (bitcoin address when using BIP39 keys).
          example: "1GChJMuyxvq28F3Uksqf5v7QkxQ4WLQdBh"
        status:
          type: string
          example: "valid"
          enum:
            - valid
            - expired
            - revoked
          description: >
            Key status:<br>
            `valid`: the key is valid and can be used to sign<br>
            `expired`: the key expired at `expiration`<br>
            `revoked`: the key was revoked at `revokedAt`
        expiration:
          type: integer
          format: int64
          example: 1569542400000
          description: >
            Key expiration date (Unix ms timestamp).<br>
            Note that the field is not returned if the key has no expiration date.
        revokedAt:
          type: integer
          format: int64
          example: 1569542400000
          description: >
            Key revocation date (Unix ms timestamp).<br>
            Note that the field is not returned if the key is not yet revoked.
    FullIdentity:
      allOf:
        - $ref: '#/components/schemas/Identity'
        - type: object
          properties:
            userId:
              type: string
              description: Custom user identifier (UID) (0.9.2342.19200300.100.1.1) must be unique for each user.
              example: "wol.jim-smith.01"
    Password:
      type: string
      format: password
      description: User password.
      example: "nSBa+rV3%2/LpD"
    PubKey:
      type: string
      description: Public key (bitcoin address when using BIP39 keys).
      example: "1GChJMuyxvq28F3Uksqf5v7QkxQ4WLQdBh"
    CreatedAt:
      type: integer
      format: int64
      readOnly: true
      description: Date of creation (Unix ms timestamp).
      example: 1529052551419
    UpdatedAt:
      type: integer
      format: int64
      readOnly: true
      description: Date of last modification (Unix ms timestamp).
      example: 1529052551419
    LastUsed:
      type: integer
      format: int64
      readOnly: true
      description: Date of last usage (Unix ms timestamp).
      example: 1529059167339
    LastLogin:
      type: integer
      format: int64
      readOnly: true
      description: Date of last login (Unix ms timestamp).
      example: 1529050155459
    UserRoleEnum:
      type: string
      enum:
        - user
        - manager
        - admin
      default: "user"
      description: >
        User role.<br>
        - `user`: a user can sign using his keys<br>
        - `manager`: a manager can manage user and seal identities and keys<br>
        - `admin`: an administrator can do everything on the server
      example: "user"
    UserStatusEnum:
      type: string
      enum:
        - active
        - blocked
      default: "active"
      description: >
        User status:<br>
        - `active`: the user is active: he can use his keys to sign<br>
        - `blocked`: the user is blocked: he cannot use his keys to sign
      example: "active"
    UserModeEnum:
      type: string
      enum:
        - seal
        - esign
      default: "seal"
      description: >
        User mode.<br>
        - `esign`: the user is a regular user, and his keys are used to create electronic signatures.<br>
        - `seal`: the user represents a legal entity, and his keys are used to create server seals.
      example: "seal"
    UserBase:
      type: object
      properties:
        email:
          type: string
          format: email
          description: User email (can be used for login).
          example: "john.doe@acme.com"
        username:
          type: string
          description: User name (can be used for login).
          example: "johndoe"
        countryCallingCode:
          type: string
          description: User country calling code
          example: "33"
        phone:
          type: string
          description: User phone number
          example: "123456789"
        status:
          $ref: '#/components/schemas/UserStatusEnum'
        role:
          $ref: '#/components/schemas/UserRoleEnum'
        identity:
          $ref: '#/components/schemas/FullIdentity'
    UserGet:
      allOf:
        - $ref: '#/components/schemas/UserBase'
        - type: object
          properties:
            id:
              type: string
              format: uuid
              readOnly: true
              description: User identifier (allocated by the server).
              example: "7c42e7e9-aec5-4d56-9a3b-bd55e129aae3"
            createdAt:
              $ref: '#/components/schemas/CreatedAt'
            updatedAt:
              $ref: '#/components/schemas/UpdatedAt'
            lastLogin:
              $ref: '#/components/schemas/LastLogin'
            mode:
              $ref: '#/components/schemas/UserModeEnum'
            defaultKeyId:
              type: string
              format: uuid
              description: Identifier of the default key to use to sign for this user (cannot be the an external key nor a e-signature key).
              example: "c7c6e0de-2acb-4311-80b4-17dbf0b76806"
    UserPost:
      allOf:
        - $ref: '#/components/schemas/UserBase'
        - type: object
          required:
            - identity
          properties:
            password:
              $ref: '#/components/schemas/Password'
            createDefaultKey:
              type: boolean
              description: If true create a key holded by the server when this user is created.
            mode:
              $ref: '#/components/schemas/UserModeEnum'
    UserPut:
      allOf:
        - $ref: '#/components/schemas/UserBase'
        - type: object
          properties:
            password:
              $ref: '#/components/schemas/Password'
            defaultKeyId:
              type: string
              format: uuid
              description: Identifier of the default key to use to sign for this user (cannot be the an external key).
              example: "c7c6e0de-2acb-4311-80b4-17dbf0b76806"
    UserArray:
      type: array
      items:
        $ref: '#/components/schemas/UserGet'
    UserInfo:
      allOf:
        - $ref: '#/components/schemas/UserBase'
    UserDisco:
      allOf:
        - $ref: '#/components/schemas/UserGet'
    UserDiscoArray:
      type: array
      items:
        $ref: '#/components/schemas/UserDisco'
    APITokenStatusEnum:
      type: string
      enum:
        - active
        - blocked
      default: "active"
      description: >
        API token status:<br>
        - `active`: the token is active: it can be used to sign<br>
        - `blocked`: the token is blocked: it cannot be used to sign
      example: "active"
    APITokenBase:
      type: object
      properties:
        name:
          type: string
          description: API token name.
          example: "My API token name"
        status:
          $ref: '#/components/schemas/APITokenStatusEnum'
    APITokenGet:
      allOf:
        - $ref: '#/components/schemas/APITokenBase'
        - type: object
          properties:
            id:
              type: string
              format: uuid
              readOnly: true
              description: API token identifier (allocated by the platform).
              example: "a35c9fee-3893-4eb7-adde-205e1be03209"
            value:
              type: string
              readOnly: true
              description: Token to use for the signature endpoint.
              example: "b9PXEeMpSCyeaPpQiZ3Bvw=="
            userId:
              type: string
              format: uuid
              description: Identifier of the authorized user.
              example: 'feb37e23-d04e-4e71-bf53-1f1a75ba3a68'
            createdAt:
              $ref: '#/components/schemas/CreatedAt'
            updatedAt:
              $ref: '#/components/schemas/UpdatedAt'
            lastUsed:
              $ref: '#/components/schemas/LastUsed'
    APITokenPost:
      allOf:
        - $ref: '#/components/schemas/APITokenBase'
        - type: object
          required:
            - name
          properties:
            userId:
              type: string
              format: uuid
              description: >
                Identifier of the authorized user.<br>
                If set, the token allows to authenticate as the user, if not the token allow to authenticate as a server admin.
              example: 'feb37e23-d04e-4e71-bf53-1f1a75ba3a68'
    APITokenPut:
      allOf:
        - $ref: '#/components/schemas/APITokenBase'
    APITokenArray:
      type: array
      items:
        $ref: '#/components/schemas/APITokenGet'
    IdentityURL:
      type: string
      format: url
      example: "https://identity.mydomain.com/identity"
      description: >
        Public URL of the **Identity endpoint** (ie. the URL that anyone can use to get the identity associated to a public key).
    SignatureURL:
      type: string
      format: url
      example: "https://sign.mydomain.com:3002"
      description: >
        Public base URL of **Signature endpoints** (ie. the base URL that authorized users can use to sign and to discover other users).
    APIURL:
      type: string
      format: url
      example: "https://mydomain.com/api"
      description: >
        Public base URL of **API endpoints** (ie. the base URL that authorized users can use to call the server API).
    APIVersion:
      type: string
      example: "1.2.5"
      description: >
        API version number of this Woleet.ID Server instance (extraced from the swagger file).
    ServerConfig:
      type: object
      properties:
        identityURL:
          $ref: '#/components/schemas/IdentityURL'
        preventIdentityExposure:
          type: boolean
          description: >
            True to prevent the identity endpoint from exposing the identities.<br>
            In this mode, the `/sign` endpoint requires the `identityToSign` parameter and the `/identity` endpoint requires the `signedIdentity` parameter:
            the sign endpoint records each (public key, signed identity) pair in the database, so that the identity endpoint can verify that the given signed identity was actually signed at least once by the given public key.
            If yes, the identity endpoint succeeds and returns only the identity fields present in the provided signed identity.
        signatureURL:
          $ref: '#/components/schemas/SignatureURL'
        APIURL:
          $ref: '#/components/schemas/APIURL'
        defaultKeyId:
          type: string
          format: uuid
          example: "7b8e5c49-18c6-4ef7-9dab-261a5e717b31"
          description: Identifier of the default key to use when signing with no user and no key specified.
        fallbackOnDefaultKey:
          type: boolean
          example: true
          description: True is the server must fallback on the default key (if any).
    KeyStatusEnum:
      type: string
      enum:
        - active
        - blocked
        - revoked
      default: "active"
      description: >
        The status of the key:<br>
        - `active`: the key is active: it can be used to sign<br>
        - `blocked`: the key is blocked: it cannot be used to sign<br>
        - `revoked` the key is revoked: it will no longer be used to sign
      example: "active"
    KeyTypeEnum:
      type: string
      enum:
        - bip39
      description: >
        The type of the key (only `bip39` is supported).<br>
        - `bip39`: Bitcoin BIP39
      example: "bip39"
    KeyDeviceEnum:
      type: string
      enum:
        - server
        - mobile
        - nano
      description: >
        The type of device storing the key.<br>
        - `server`: Woleet.ID Server or equivalent<br>
        - `mobile`: Woleet.ID Mobile or equivalent<br>
        - `nano`: Ledger Nano S or equivalent
      example: "server"
    KeyHolderEnum:
      type: string
      enum:
        - server
        - user
      description: >
        The type of entity holding the private key.<br>
        - `server`: the server (Woleet.ID Server or equivalent)<br>
        - `user`: the user (eg. by using a Ledger Nano S or Woleet.ID Mobile or equivalent)
      example: "server"
    KeyBase:
      type: object
      properties:
        name:
          type: string
          description: Key name.
          example: "Jim Smith's key"
        expiration:
          type: integer
          format: int64
          example: 1569542400000
          description: >
            Key expiration date (Unix ms timestamp).<br>
            Note that the field is not returned if the key has no expiration date.
        status:
          $ref: '#/components/schemas/KeyStatusEnum'
    KeyGet:
      allOf:
        - $ref: '#/components/schemas/KeyBase'
        - type: object
          required:
            - name
          properties:
            id:
              type: string
              format: uuid
              readOnly: true
              description: Key identifier (allocated by the platform).
              example: "a35c9fee-3893-4eb7-adde-205e1be03209"
            pubKey:
              $ref: '#/components/schemas/PubKey'
            type:
              $ref: '#/components/schemas/KeyTypeEnum'
            holder:
              $ref: '#/components/schemas/KeyHolderEnum'
            device:
              $ref: '#/components/schemas/KeyDeviceEnum'
            expired:
              type: boolean
              example: false
              description: >
                Indicates whether the key has expired or not.<br>
                Note that the field is not returned if the key has not expired.
            revokedAt:
              type: integer
              format: int64
              example: 1569542400000
              description: >
                Key revocation date (Unix ms timestamp).<br>
                Note that the field is not returned if the key has no revocation date.
            createdAt:
              $ref: '#/components/schemas/CreatedAt'
            updatedAt:
              $ref: '#/components/schemas/UpdatedAt'
            lastUsed:
              $ref: '#/components/schemas/LastUsed'
    KeyPost:
      allOf:
        - $ref: '#/components/schemas/KeyBase'
        - type: object
          required:
            - name
    KeyPut:
      allOf:
        - $ref: '#/components/schemas/KeyBase'
        - type: object
          properties:
            device:
              $ref: '#/components/schemas/KeyDeviceEnum'
    KeyArray:
      type: array
      items:
        $ref: '#/components/schemas/KeyGet'
    KeyDisco:
      allOf:
        - $ref: '#/components/schemas/KeyGet'
    KeyDiscoArray:
      type: array
      items:
        $ref: '#/components/schemas/KeyDisco'
    ConfigDisco:
      type: object
      properties:
        identityURL:
          $ref: '#/components/schemas/IdentityURL'
        signatureURL:
          $ref: '#/components/schemas/SignatureURL'
        APIURL:
          $ref: '#/components/schemas/APIURL'
        APIVersion:
          $ref: '#/components/schemas/APIVersion'
    ExternalKeyPost:
      type: object
      properties:
        name:
          type: string
          description: Key name.
          example: "Jim Smith's key"
        publicKey:
          type: string
          description: Public key (bitcoin address when using BIP39 keys).
          example: "1HA79GnnZdHLZBMBQusXcgPEeMcrpnWahb"
        device:
          $ref: '#/components/schemas/KeyDeviceEnum'
        status:
          $ref: '#/components/schemas/KeyStatusEnum'
        expiration:
          type: integer
          format: int64
          example: 1569542400000
          description: >
            Key expiration date (Unix ms timestamp).
      required:
        - name
        - publicKey
    SignatureResult:
      type: object
      properties:
        pubKey:
          type: string
          example: "1KjQ8LgUgYVSqeK7JFhA9W8FVsHCzFrFi8"
          description: Public key used to sign (must be the same as the `pubKey` parameter if provided).
        signedHash:
          type: string
          format: hex
          example: "01ba4719c80b6fe911b091a7c05124b64eeece964e09c058ef8f9805daca546b"
          description: SHA256 hash that is signed (same as the `hashToSign` parameter).
        signedMessage:
          type: string
          format: hex
          example: "Love is the message!"
          description: Message that is signed (same as the `messageToSign` parameter).
        signature:
          type: string
          format: base64
          example: "IKnOvW2/BQqahssC2l9Icz7qiJQqesgu0HCKvW/L5xZLaMCLyg19ATDNJojMILdUijFOqiRzgk6ieDXi89DeB0Q="
          description: >
            Signature of `signedMessage` or `signedHash` using the public key `pubKey`,
            or signature of SHA256(`signedMessage` or `signedHash` + `signedIdentity` + `signedIssuerDomain`)
            if the identity of the signer and the domain of the identity issuer are included to the signed data.
        identityURL:
          $ref: '#/components/schemas/IdentityURL'
        signedIdentity:
          type: string
          example: "CN=John Doe,EMAILADDRESS=john.doe@acme.com,O=Acme corp,OU=Sales dept"
          description: >
            Identity of the signer (as a X500 Distinguished Name).<br>
            Returned only if `identityToSign` is used.
        signedIssuerDomain:
          type: string
          example: "acme.com"
          description: >
            Domain of the identity issuer (ie. of the organization who verified the identity).<br>
            Returned only if `identityToSign` is used.
    IdentityResult:
      type: object
      properties:
        rightData:
          type: string
          description: >
            The right part of the signed data (generated randomly).<br>
            To prevent man-in-the-middle attacks, the data starts with the server's identity URL and this should be verified by the caller.
        signature:
          type: string
          format: base64
          example: "IKnOvW2/BQqahssC2l9Icz7qiJQqesgu0HCKvW/L5xZLaMCLyg19ATDNJojMILdUijFOqiRzgk6ieDXi89DeB0Q="
          description: >
            The signature of the concatenation of `leftData` and `rightData` using the public key `pubKey`.
        identity:
          $ref: '#/components/schemas/Identity'
        key:
          $ref: '#/components/schemas/Key'
    APIError:
      type: object
      properties:
        error:
          type: object
          properties:
            code:
              type: integer
              format: int32
              example: 418
            message:
              type: string
              example: "I'm a teapot"
          required:
            - code
            - message
    EnrollmentBase:
      type: object
      properties:
        name:
          type: string
          description: Name of the enrolled key.
          example: 'test'
        device:
          $ref: '#/components/schemas/KeyDeviceEnum'
        expiration:
          type: integer
          format: int64
          example: 1569542400000
          description: >
            Enrollment expiration date (Unix ms timestamp).<br>
            Note that the field is not returned if the enrollment has no expiration date.
        keyExpiration:
          type: integer
          format: int64
          example: 1569542400000
          description: >
            Enrolled key expiration date (Unix ms timestamp).<br>
            Note that the field is not returned if the enrollment has no expiration date.
    EnrollmentGet:
      allOf:
        - $ref: '#/components/schemas/EnrollmentBase'
        - type: object
          properties:
            id:
              type: string
              format: uuid
              description: Enrollment identifier (allocated by the server).
              example: "feb37e23-d04e-4e71-bf53-1f1a75ba3a68"
            userId:
              type: string
              format: uuid
              description: Identifier of the enrolled user.
              example: 'feb37e23-d04e-4e71-bf53-1f1a75ba3a68'
    EnrollmentPost:
      allOf:
        - $ref: '#/components/schemas/EnrollmentBase'
        - type: object
          required:
            - userId
            - name
          properties:
            userId:
              type: string
              format: uuid
              description: Identifier of the enrolled user.
              example: 'feb37e23-d04e-4e71-bf53-1f1a75ba3a68'
            test:
              type: boolean
              description: Used only for test purpose only.
    EnrollmentPut:
      allOf:
        - $ref: '#/components/schemas/EnrollmentBase'
    EnrollmentArray:
      type: array
      items:
        $ref: '#/components/schemas/EnrollmentGet'
  parameters:
    UserIdParameter:
      name: userId
      in: path
      description: Identifier of the user.
      required: true
      schema:
        type: string
        format: uuid
        example: 'feb37e23-d04e-4e71-bf53-1f1a75ba3a68'
    KeyIdParameter:
      name: keyId
      in: path
      description: Identifier of the key.
      required: true
      schema:
        type: string
        format: uuid
        example: "552aa3fd-3b5e-434f-bdd3-9b6c58c269c1"
    APITokenIdParameter:
      name: APITokenId
      in: path
      description: Identifier of the API token.
      required: true
      schema:
        type: string
        format: uuid
        example: "f34d92e3-4f71-49ab-862f-69443bd48266"
    PubKeyParameter:
      name: pubKey
      in: path
      description: Public key (bitcoin address when using BIP39 keys).
      required: true
      schema:
        type: string
        example: "1GChJMuyxvq28F3Uksqf5v7QkxQ4WLQdBh"
    PubKeyQueryParameter:
      name: pubKey
      in: query
      description: >
        The public key to use to sign.<br>
        When not provided and a user is provided, the default key of the user is used (if any).<br>
        When not provided and no user is provided, the default key of the server is used (if any).
      required: false
      schema:
        type: string
        example: "1GChJMuyxvq28F3Uksqf5v7QkxQ4WLQdBh"
    PathQueryParameter:
      name: path
      in: query
      description: >
        The derivation path of the key to use to sign.<br>
        When not provided, the default derivation path "m/44'/0'/0'" is used.
      required: false
      schema:
        type: string
        example: "m/'44/'0/'1"
    IdentityToSignQueryParameter:
      name: identityToSign
      in: query
      description: >
        Identity to sign: when set, the identity of the signer and the domain of the identity issuer are included to the signed data.<br>
        The identity of the signer is the X500 Distinguished Name built by the server from the identity associated to the key.<br>
        The domain of the identity issuer is extracted from the server's identity URL.<br>
        Both are included to the signed data: the signature produced in this case is the signature of SHA256(hash or message to sign + identity of the signer + domain of the identity issuer).<br>
        The identity of the signer and the domain of the identity issuer are returned respectively in the `signedIdentity` and the `signedIssuerDomain` fields of the signature result.<br>
        You must specify the fields you want to include in the identity of the signer by providing a string containing the list of the X500 fields to include, separated with ',':<br>
          CN: Common name<br>
          EMAILADDRESS: Email address<br>
          O: Organization<br>
          OU: Organizational unit<br>
          L: Locality<br>
          C: Country<br>
        If you want to include all fields, you can also provide ALL.
      required: false
      schema:
        type: string
        example: "CN,EMAILADDRESS,O,OU,L,C"
    PubKeyToVerifyQueryParameter:
      name: pubKey
      in: query
      description: Public key to verify.
      required: true
      schema:
        type: string
        example: "1GChJMuyxvq28F3Uksqf5v7QkxQ4WLQdBh"
    SignedIdentityToVerifyQueryParameter:
      name: signedIdentity
      in: query
      description: >
        Identity to verify (as a X500 Distinguished Name).<br>
        This identity must have been signed at least once by the public key.
      required: false
      schema:
        type: string
        example: 'CN=John Doe,EMAILADDRESS=john.doe@acme.com'
    LeftDataQueryParameter:
      name: leftData
      in: query
      description: >
        Left part of the random data to sign (should be generated randomly).<br>
        When not provided, the server does not return a signature, even if it controls the key.
      required: false
      schema:
        type: string
        example: '00c8a2b0c373050e7f2abbb2e4c631a42c10d402'
    CustomUserIdQueryParameter:
      name: customUserId
      in: query
      description: Custom user identifier (ie. `userId` field of the user identity).
      required: false
      schema:
        type: string
        example: "wol.jim-smith.01"
    UserIdQueryParameter:
      name: userId
      in: query
      description: User identifier.
      required: false
      schema:
        type: string
        format: uuid
        example: "345a4513-0266-419a-8344-2daf645b78ed"
    HashToSignQueryParameter:
      name: hashToSign
      in: query
      description: SHA256 hash to be signed (a string formatted like [a-f0-9]{64}).
      schema:
        type: string
        example: 'd8e734d7c02e5b889e3e15acd5aaf231a67e1d9974f17b2c907148c4f4a7f975'
    MessageToSignQueryParameter:
      name: messageToSign
      in: query
      description: Message to be signed.
      schema:
        type: string
        example: 'This is the message to be signed'
    PagingOffsetQueryParameter:
      name: offset
      in: query
      description: Offset of the returned results (0 to get all results from the beginning).
      required: false
      schema:
        type: integer
        example: 20
    PagingLimitQueryParameter:
      name: limit
      in: query
      description: Maximum number of returned results.
      required: false
      schema:
        type: integer
        example: 20
    FilterUserSearchQueryParameter:
      name: search
      in: query
      description: >
        Filter the users using a search string.<br>
        Only users whose `email`, `username`, `identity.commonName`, `identity.organization` or `identity.organizationalUnit` contains the search string match.
      required: false
      schema:
        type: string
        example: "John Doe"
    FilterUserModeQueryParameter:
      name: mode
      in: query
      description: Filter the users by their mode (exact match).
      required: false
      schema:
        type: string
        enum:
          - seal
          - esign
        example: 'seal'
    FilterUserRoleQueryParameter:
      name: role
      in: query
      description: Filter the users by their role (exact match).
      required: false
      schema:
        type: string
        enum:
          - user
          - manager
          - admin
        example: 'user'
    FilterUserEmailQueryParameter:
      name: email
      in: query
      description: Filter the users by their email (exact match).
      required: false
      schema:
        type: string
        example: 'john.doe@acme.com'
    FilterUserUsernameQueryParameter:
      name: username
      in: query
      description: Filter the users by their username (exact match).
      required: false
      schema:
        type: string
        example: 'johndoe'
    FilterUserCommonNameQueryParameter:
      name: commonName
      in: query
      description: Filter the users by their X500 common name (exact match).
      required: false
      schema:
        type: string
        example: 'John Doe'
    FilterUserOrganizationQueryParameter:
      name: organization
      in: query
      description: Filter the users by their X500 organization (exact match).
      required: false
      schema:
        type: string
        example: 'Acme corp'
    FilterUserOrganizationalUnitQueryParameter:
      name: organizationalUnit
      in: query
      description: Filter the users by their X500 organizational unit (exact match).
      required: false
      schema:
        type: string
        example: 'Sales dept'
    FilterUserLocalityQueryParameter:
      name: locality
      in: query
      description: Filter the users by their X500 locality (exact match).
      required: false
      schema:
        type: string
        example: 'Rennes'
    FilterUserCountryQueryParameter:
      name: country
      in: query
      description: Filter the users by their X500 country (exact match).
      required: false
      schema:
        type: string
        example: 'FR'
    FilterUserUserIdQueryParameter:
      name: userId
      in: query
      description: Filter the users by their X500 custom user identifier (exact match).
      required: false
      schema:
        type: string
        example: 'wol.jim-smith.01'
    FilterUserCountryCallingCodeQueryParameter:
      name: countryCallingCode
      in: query
      description: Filter the users by their country calling code (exact match).
      required: false
      schema:
        type: string
        example: '33'
    FilterUserPhoneQueryParameter:
      name: phone
      in: query
      description: Filter the users by their phone (exact match).
      required: false
      schema:
        type: string
        example: '123456789'
    FilterUserStatusQueryParameter:
      name: status
      in: query
      description: Filter the users by their status (exact match).
      required: false
      schema:
        type: string
        enum:
          - active
          - blocked
        example: 'active'
    EnrollmentIdParameter:
      name: EnrollmentId
      in: path
      description: Identifier of the enrollment.
      required: true
      schema:
        type: string
        format: uuid
        example: "813797c8-01e3-4a80-8068-bc2bda13df16"
  requestBodies:
    KeyPost:
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/KeyPost'
      description: Key object to add.
      required: true
    ExternalKeyPost:
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ExternalKeyPost'
      description: External key object to add.
      required: true
    KeyPut:
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/KeyPut'
      description: Key object to update.
      required: true
    APITokenPost:
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/APITokenPost'
      description: API token object to add.
      required: true
    APITokenPut:
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/APITokenPut'
      description: API token object to update.
      required: true
    ServerConfig:
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ServerConfig'
      description: Server config object.
      required: true
    EnrollmentPost:
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/EnrollmentPost'
      description: Enrollment object to add.
      required: true
    EnrollmentPut:
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/EnrollmentPut'
      description: Enrollment object to update.
      required: true
  responses:
    UserGet:
      $ref: '#/components/schemas/UserGet'
    UserArray:
      $ref: '#/components/schemas/UserArray'
    UserInfo:
      $ref: '#/components/schemas/UserInfo'
    UserDisco:
      $ref: '#/components/schemas/UserDisco'
    KeyDiscoArray:
      $ref: '#/components/schemas/KeyDiscoArray'
    UserDiscoArray:
      $ref: '#/components/schemas/UserDiscoArray'
    ConfigDisco:
      $ref: '#/components/schemas/ConfigDisco'
    APIError:
      $ref: '#/components/schemas/APIError'
    KeyGet:
      $ref: '#/components/schemas/KeyGet'
    KeyArray:
      $ref: '#/components/schemas/KeyArray'
    APITokenGet:
      $ref: '#/components/schemas/APITokenGet'
    APITokenArray:
      $ref: '#/components/schemas/APITokenArray'
    ServerConfig:
      $ref: '#/components/schemas/ServerConfig'
    EnrollmentGet:
      $ref: '#/components/schemas/EnrollmentGet'
    EnrollmentArray:
      $ref: '#/components/schemas/EnrollmentArray'
  securitySchemes:
    BasicAuth:
      type: http
      scheme: basic
      description: Use email/username and password to authenticate.
    CookieAuth:
      type: apiKey
      in: cookie
      name: session
      description: Use a session cookie to authenticate (see /login).
    APITokenAuth:
      type: http
      scheme: bearer
      description: Use an API token to authenticate (see /api-token).
    OAuthTokenAuth:
      type: http
      scheme: bearer
      description: Use an OAuth access token to authenticate.
